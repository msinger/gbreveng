<html>
<head>
<title>DMG-CPU Cell Examination</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>img { max-width: 100%; display: inline; }</style>
</head>
<body>
<p><a href="http://iceboy.a-singer.de/">Home</a></p>
<hr>
<h1>DMG-CPU Cell Examination</h1>
<p>This document provides information about the cells found in the
<a href="https://siliconpr0n.org/map/nintendo/dmg-cpu-b/">Gameboy DMG-CPU-B die shot</a>.
It builds on the work of Furrtek, the information found in his
<a href="https://github.com/furrtek/DMG-CPU-Inside">DMG-CPU-Inside</a> repository.</p>
<p>I will try to provide descriptions for how I determine the polarity of some of the cells clock inputs.
I'm writing it down, because I constantly question my assumptions, whenever I discover a new part of
the schematic that makes no sense to me at first. This way I don't have to go through this anew each time.</p>
<p>For a reference of all the cells see <a href="dmg_cells.html">here</a>.</p>
<p>Please report any errors I made <a href="https://github.com/msinger/gbreveng/issues">here</a>.</p>
<h2 id="dffr_b_clk">DFFR - Variant B clock polarity</h2>
<p>The clock polarity of the <a href="dmg_cells.html#dffr_b">variant B of DFFR cells</a> can be inferred
using these cells:</p>
<p><table border="0"><tr><td><p><img src="img/cells/esut_eros_dape.png"></p></td>
<td><p><img src="img/cells/esut_eros_dape_sch.png"></p></td></tr></table></p>
<p>This is a 3 bit counter implemented like this: The clock inputs of
<a href="/dmg_cpu_b_map/?view=eros">EROS</a> are driven by <i>q</i> and <i>!q</i> of
<a href="/dmg_cpu_b_map/?view=esut">ESUT</a>. The clock inputs of
<a href="/dmg_cpu_b_map/?view=dape">DAPE</a> are driven by the outputs of
<a href="/dmg_cpu_b_map/?view=eros">EROS</a>. We can determine the polarity of <i>q</i> and <i>!q</i>
immediately, because each cell has its <i>!q</i> output routed into its own <i>d</i> input. So each time they get clocked
they invert themselfes. That's how you count! It wouldn't make sense to feed the <i>q</i> output into <i>d</i>, because
then the content of the FF would never change. Now that we have established the output polarity, let's move on to the
clocks.</p>
<p>The next higher bit in a counter has to toggle whenever the previous bit changes back from 1 to 0. In other words: When
<i>q</i> falls and <i>!q</i> rises. That is what we see in the picture above: <i>!Q</i> (the positive edge) is connected
to the <i>clk</i> input and <i>q</i> (the negative edge) is connected to the <i>!clk</i> input.</p>
<p>Take note that the least significant bit of this counter (<a href="/dmg_cpu_b_map/?view=esut">ESUT</a>)
is a <a href="dmg_cells.html#dffr_b2">B+ variant</a>. We can't determine it's clock polarity from this
circuit, but we can use <a href="#dffr_b2_clk">this one</a>.</p>
<p><a href="/dmg_cpu_b_map/?view=cano">CANO</a>, <a href="/dmg_cpu_b_map/?view=cagy">CAGY</a> and
<a href="/dmg_cpu_b_map/?view=dyve">DYVE</a> are another example of the same type of 3 bit counter.</p>
<h2 id="dffr_b2_clk">DFFR - Variant B+ clock polarity</h2>
<p>The clock polarity of the <a href="dmg_cells.html#dffr_b2">variant B+ of DFFR cells</a> can be inferred
using these cells:</p>
<p><table border="0"><tr><td><p><img src="img/cells/bese_cuxy_bego_dybe.png"></p></td>
<td><p><img src="img/cells/bese_cuxy_bego_dybe_sch.png"></p></td></tr></table></p>
<p>This is a 4 bit counter implemented like this: The <i>!q</i> output of
<a href="/dmg_cpu_b_map/?view=bese">BESE</a> is driving the clock input of
<a href="/dmg_cpu_b_map/?view=cuxy">CUXY</a>. The <i>!q</i> output of
<a href="/dmg_cpu_b_map/?view=cuxy">CUXY</a> is driving the clock input of
<a href="/dmg_cpu_b_map/?view=bego">BEGO</a>. And finally the <i>!q</i> output of
<a href="/dmg_cpu_b_map/?view=bego">BEGO</a> is driving the clock input of
<a href="/dmg_cpu_b_map/?view=dybe">DYBE</a>. We can determine the polarity of <i>q</i> and <i>!q</i>
immediately, because each cell has its <i>!q</i> output routed into its own <i>d</i> input. So each time they get clocked
they invert themselfes. It wouldn't make sense to feed the <i>q</i> output into <i>d</i>, because
then the content of the FF would never change.</p>
<p>The next higher bit in a counter has to toggle whenever the previous bit changes back from 1 to 0. In other words: When
<i>q</i> falls and <i>!q</i> rises. In the picture above, the <i>!q</i> output (the positive edge) is connected
to the <i>clk</i> input, so these FFs will have to trigger on the positive edge. There is not a single instance of
this B+ variant that has their clock extension part at the top connected differently, so they all are pos-edged.</p>
<h2 id="dffsr_clk">DFFSR clock polarity</h2>
<p>The clock polarity of the <a href="dmg_cells.html#dffsr">DFFSR cells</a> can be easily inferred by looking at the
interrupt flags register. All the interrupt signals are active high and are routed directly into the clock input of
DFFSRs. Case closed.</p>
<hr>
<p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
</body>
</html>
